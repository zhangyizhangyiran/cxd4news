package com.micros.ui.webview;import android.content.Context;import android.content.DialogInterface;import android.content.Intent;import android.content.pm.PackageInfo;import android.content.pm.PackageManager;import android.net.Uri;import android.support.v7.app.AlertDialog;import android.util.Log;import android.widget.Toast;import com.tencent.smtt.sdk.DownloadListener;import java.util.ArrayList;import java.util.HashMap;import java.util.List;import static android.app.Activity.RESULT_OK;/** * Created by wangxiaofa on 16/11/2. * webview 实现下载文件功能 * <p> * 调用方法:        webview.setDownloadListener(new X5WebViewDownLoadListener(getActivity())); */public class X5WebViewDownLoadListener implements DownloadListener {    private Context mContext;    private static final String packageName = "com.ghbank.directbank";    public X5WebViewDownLoadListener(Context mContext) {        this.mContext = mContext;    }    @Override    public void onDownloadStart(final String s, String s1, String s2, String s3, long l) {        isAppInstalled(s);    }    //判断是否安装    /*    * check the app is installed    */    private boolean isAppInstalled(String packageURL) {        PackageInfo packageInfo;        try {            packageInfo = mContext.getPackageManager().getPackageInfo(packageName, 0);        } catch (PackageManager.NameNotFoundException e) {            packageInfo = null;            e.printStackTrace();        }        if (packageInfo == null) {           //下载apk包方式一:            Uri uri = Uri.parse(packageURL);            Intent intent = new Intent(Intent.ACTION_VIEW, uri);            mContext.startActivity(intent);            //System.out.println("没有安装");            /**方式二**///            Uri uri = Uri.parse("market://details?id=" + packageName);//id为包名//            Intent it = new Intent(Intent.ACTION_VIEW, uri);//            mContext.startActivity(it);            return false;        } else {            //System.out.println("已经安装"); 只能打开 xml中 有 android.intent.category.LAUNCHER 的应用            setShowDiolog();            return true;        }    }    //是否打开华兴银行app对话框    private void setShowDiolog() {        new AlertDialog.Builder(mContext)                .setTitle("已安装华兴投融资平台,直接打开?")                .setPositiveButton("打开",                        new DialogInterface.OnClickListener() {                            @Override                            public void onClick(DialogInterface dialog,                                                int which) {                                Intent mainIntent = mContext.getPackageManager().getLaunchIntentForPackage(packageName);                                mContext.startActivity(mainIntent);                            }                        })                .setNegativeButton("取消",                        new DialogInterface.OnClickListener() {                            @Override                            public void onClick(DialogInterface dialog,                                                int which) {                            }                        }).show();    }}